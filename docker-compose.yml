version: '3.8'

services:
  # Daemon: Scrapes AudioBookBay every 60 minutes
  bind-daemon:
    build: .
    image: bind:latest
    container_name: bind-daemon
    restart: unless-stopped
    environment:
      - PYTHONUNBUFFERED=1
    volumes:
      - magnets:/app/magnets
      - ./logs:/app/logs
    command: [ "python", "-m", "src.bind", "daemon", "--interval", "60", "--output-dir", "magnets/" ]

  # RSS Server: Serves Web UI and RSS feed on port 5050
  bind-rss:
    build: .
    image: bind:latest
    container_name: bind-rss
    restart: unless-stopped
    environment:
      - PYTHONUNBUFFERED=1
      - MAGNETS_DIR=/app/magnets
    ports:
      - "5050:5050"
    volumes:
      - magnets:/app/magnets
    command: [ "python", "-m", "src.rss_server" ]
    depends_on:
      - bind-daemon

volumes:
  magnets: # Shared volume for magnet files between daemon and RSS server
